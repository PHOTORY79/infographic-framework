<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>인포그래픽 포토리 프레임워크</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome 아이콘 사용을 위한 CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>인포그래픽 프레임워크</h1>
      <p>CSV 데이터를 구조화된 인포그래픽으로 변환하는 도구</p>
    </header>

    <!-- 탭 네비게이션 -->
    <ul class="nav nav-tabs mb-3" id="inputTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="csv-tab" data-bs-toggle="tab" data-bs-target="#csv-panel" type="button" role="tab" aria-controls="csv-panel" aria-selected="true">
          <i class="fas fa-file-csv me-1"></i> CSV 입력
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="spreadsheet-tab" data-bs-toggle="tab" data-bs-target="#spreadsheet-panel" type="button" role="tab" aria-controls="spreadsheet-panel" aria-selected="false">
          <i class="fas fa-table me-1"></i> 스프레드시트
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload-panel" type="button" role="tab" aria-controls="upload-panel" aria-selected="false">
          <i class="fas fa-upload me-1"></i> 파일 업로드
        </button>
      </li>
    </ul>

    <div class="tab-content" id="inputTabsContent">
      <!-- CSV 입력 패널 -->
      <div class="tab-pane fade show active" id="csv-panel" role="tabpanel" aria-labelledby="csv-tab">
        <div class="panel">
          <div class="panel-header" id="csvInputHeader">
            <h2><i class="fas fa-table icon"></i> CSV 데이터 입력</h2>
            <i class="fas fa-chevron-down toggle-icon"></i>
          </div>
          <div class="panel-body" id="csvInputBody">
            <div class="csv-input">
              <textarea id="csv-input" placeholder="3자리 ID와 키워드를 쉼표로 구분하여 입력하세요. 각 항목은 새 줄에 입력합니다.&#10;&#10;예: 101,Bar Chart&#10;102,Business Presentation&#10;301,Vertical&#10;302,Corporate"></textarea>
              <p>각 항목은 3자리 ID와 쉼표, 그리고 키워드로 구성됩니다.</p>
            </div>
            <div class="btn-group">
              <button class="btn btn-primary" id="generate-button">
                <i class="fas fa-magic icon"></i> 인포그래픽 생성
              </button>
              <button class="btn btn-secondary" id="parseCSVBtn">
                <i class="fas fa-file-csv icon"></i> CSV 파싱
              </button>
            </div>

           <div class="toolbar-section mt-3">
            <div class="card mb-3">
              <div class="card-header bg-light">
                <h3 class="mb-0"><i class="fas fa-magic me-2"></i>인포그래픽 예제 보기</h3>
              </div>
              <div class="card-body">
                <p class="text-muted">템플릿을 선택하여 인포그래픽 예제를 확인할 수 있습니다.</p>
                <select id="template-selector" class="form-select mb-3">
                  <option value="bar-chart">막대 차트</option>
                  <option value="pie-chart">파이 차트</option>
                  <option value="line-chart">선 그래프</option>
                  <option value="radar-chart">레이더 차트</option>
                  <option value="process-diagram">프로세스 다이어그램</option>
                  <option value="comparison-chart">비교 차트</option>
                  <option value="timeline">타임라인</option>
                </select>
              </div>
            </div>
            
            <h3>차트 속성 변경:</h3>
            <div class="row mt-3">
              <div class="col-md-6">
                <label for="chart-type-selector" class="form-label">차트 유형:</label>
                  <select id="chart-type-selector" class="form-select mb-2">
                    <option value="Bar Chart">막대 차트</option>
                    <option value="Pie Chart">파이 차트</option>
                    <option value="Line Chart">선 그래프</option>
                    <option value="Radar Chart">레이더 차트</option>
                    <option value="Process Diagram">프로세스 다이어그램</option>
                    <option value="Timeline">타임라인</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="color-scheme-selector" class="form-label">색상 스키마:</label>
                  <select id="color-scheme-selector" class="form-select mb-2">
                    <option value="Corporate">Corporate</option>
                    <option value="Vibrant">Vibrant</option>
                    <option value="Monochromatic">Monochromatic</option>
                    <option value="Cool Tones">Cool Tones</option>
                    <option value="Warm Tones">Warm Tones</option>
                    <option value="Brand Colors">Brand Colors</option>
                    <option value="High Contrast">High Contrast</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 스프레드시트 패널 -->
      <div class="tab-pane fade" id="spreadsheet-panel" role="tabpanel" aria-labelledby="spreadsheet-tab">
        <div class="panel">
          <div class="panel-header">
            <h2><i class="fas fa-table icon"></i> 스프레드시트 데이터 입력</h2>
            <i class="fas fa-chevron-down toggle-icon"></i>
          </div>
          <div class="panel-body">
            <div id="spreadsheet-container"></div>
            <div class="d-flex mt-3 gap-2">
              <button id="data-to-chart-btn" class="btn btn-primary">
                <i class="fas fa-chart-bar me-1"></i> 인포그래픽 데이터로 변환
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- 파일 업로드 패널 -->
      <div class="tab-pane fade" id="upload-panel" role="tabpanel" aria-labelledby="upload-tab">
        <div class="panel">
          <div class="panel-header">
            <h2><i class="fas fa-upload icon"></i> 파일 업로드</h2>
            <i class="fas fa-chevron-down toggle-icon"></i>
          </div>
          <div class="panel-body">
            <div class="mb-3">
              <label for="file-upload" class="form-label">CSV 또는 Excel 파일 업로드</label>
              <input class="form-control" type="file" id="file-upload" accept=".csv,.xlsx,.xls">
              <div class="form-text">CSV 또는 Excel 파일을 업로드하면 자동으로 데이터를 처리합니다.</div>
            </div>
            <div id="upload-preview" class="mt-3">
              <!-- 업로드된 파일 미리보기가 여기에 표시됩니다 -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 프레임워크 데이터 패널 -->
    <div class="panel">
      <div class="panel-header" id="frameworkDataHeader">
        <h2><i class="fas fa-layer-group icon"></i> 프레임워크 데이터</h2>
        <i class="fas fa-chevron-down toggle-icon"></i>
      </div>
      <div class="panel-body" id="frameworkDataBody">
        <div class="framework-data">
          <!-- 데이터는 JavaScript로 채워집니다 -->
          <div class="data-item">
            <h3>메타 레이어 (100번대)</h3>
            <div class="data-value" id="metaLayerData">데이터가 없습니다.</div>
          </div>
          <div class="data-item">
            <h3>데이터 레이어 (200번대)</h3>
            <div class="data-value" id="dataLayerData">데이터가 없습니다.</div>
          </div>
          <div class="data-item">
            <h3>디자인 레이어 (300번대)</h3>
            <div class="data-value" id="designLayerData">데이터가 없습니다.</div>
          </div>
          <div class="data-item">
            <h3>콘텐츠 레이어 (400번대)</h3>
            <div class="data-value" id="contentLayerData">데이터가 없습니다.</div>
          </div>
          <div class="data-item">
            <h3>기술 레이어 (500번대)</h3>
            <div class="data-value" id="techLayerData">데이터가 없습니다.</div>
          </div>
          <div class="data-item">
            <h3>데이터 레이블 레이어 (600번대)</h3>
            <div class="data-value" id="dataLabelLayerData">데이터가 없습니다.</div>
          </div>
          <div class="data-item">
            <h3>데이터 값 레이어 (700번대)</h3>
            <div class="data-value" id="dataValueLayerData">데이터가 없습니다.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 인포그래픽 미리보기 -->
    <div class="preview-container">
      <div class="preview-header">
        <h2><i class="fas fa-eye"></i> 인포그래픽 미리보기</h2>
      </div>
      <div id="error-container"></div>
      <div class="preview-content" id="preview-container">
        <!-- 인포그래픽이 여기에 렌더링됩니다 -->
        <div style="text-align: center; color: #6b7280;">
          <i class="fas fa-chart-bar" style="font-size: 3rem; margin-bottom: 1rem;"></i>
          <p>인포그래픽을 생성하려면 CSV 데이터를 입력하고 '인포그래픽 생성' 버튼을 클릭하세요.<BR>ⓒ PHOTORY</BR></p>
        </div>
      </div>
      <div class="preview-info" id="previewInfo" style="display: none;">
        <h3>인포그래픽 정보</h3>
        <ul id="infographicDetails">
          <!-- 인포그래픽 세부 정보가 여기에 표시됩니다 -->
        </ul>
      </div>
      <div class="export-buttons mt-3">
        <button class="btn btn-primary" id="download-button" disabled>
          <i class="fas fa-download icon"></i> SVG 다운로드
        </button>
        <button class="btn btn-secondary" id="copy-svg-button">
          <i class="fas fa-copy icon"></i> SVG 코드 복사
        </button>
        <button class="btn btn-secondary" id="copy-json-button">
          <i class="fas fa-code icon"></i> JSON 데이터 복사
        </button>
      </div>
    </div>
  </div>

  <!-- 도움말 버튼 -->
  <button class="help-btn" id="helpBtn" title="도움말">
    <i class="fas fa-question"></i>
  </button>

  <!-- XLSX.js 라이브러리 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- 모듈화된 JavaScript 파일들 -->
  <script type="module" src="js/utils.js"></script>
  <script type="module" src="js/csv-parser.js"></script>
  <script type="module" src="js/spreadsheet.js"></script>
  <script type="module" src="js/file-upload.js"></script>
  <script type="module" src="js/chart-renderers.js"></script>
  <script type="module" src="js/main.js"></script>

  <script>
  // 페이지 완전히 로드된 후 실행
  window.addEventListener('load', function() {
    // 요소 참조
    const templateSelector = document.getElementById('template-selector');
    const csvInput = document.getElementById('csv-input');
    const chartTypeSelector = document.getElementById('chart-type-selector');
    const errorContainer = document.getElementById('error-container');
    
    // 템플릿 데이터 (templates 전역 변수가 없는 경우 대비)
    const templateData = {
      'bar-chart': `101,Bar Chart\n102,Business Presentation\n103,Executives\n201,Numerical\n202,Comparison\n301,Vertical\n302,Corporate\n401,분기별 매출 실적\n402,매 분기 꾸준한 성장세를 보이고 있습니다.\n403,Values Only\n501,SVG\n601,["Q1", "Q2", "Q3", "Q4"]\n602,"매출(백만원)"\n701,[120, 150, 130, 180]\n706,160`,
      'pie-chart': `101,Pie Chart\n102,Report\n103,Stakeholders\n201,Categorical\n202,Composition\n301,Single Focus\n302,Vibrant\n401,지역별 매출 비중\n403,Percentage\n501,SVG\n601,["서울", "부산", "인천", "대구", "광주"]\n701,[40, 25, 15, 12, 8]`,
      'line-chart': `101,Line Chart\n102,Business Presentation\n201,Temporal\n202,Trend\n301,Horizontal\n302,Corporate\n401,분기별 매출 추이\n501,SVG\n601,["Q1", "Q2", "Q3", "Q4"]\n602,"매출(백만원)"\n701,[120, 150, 130, 180]`,
      'radar-chart': `101,Radar Chart\n102,Comparison Analysis\n202,Comparison\n301,Single Focus\n302,Brand Colors\n401,제품 성능 비교\n501,SVG\n601,["성능", "가격", "디자인", "내구성", "사용성"]\n602,"점수"\n603,["제품 A", "제품 B"]\n606,["0", "1", "2", "3", "4", "5"]\n701,[4, 3, 5, 4, 3]\n702,[3, 5, 2, 5, 4]`,
      'process-diagram': `101,Process Diagram\n102,Educational\n202,Sequential\n301,Horizontal\n302,Vibrant\n304,Flat Icons\n305,Arrows\n306,Size Variation\n401,5단계 제품 개발 프로세스\n402,아이디어부터 출시까지의 주요 단계\n501,SVG\n504,Sequential Reveal\n601,["아이디어 발굴", "컨셉 개발", "설계", "테스트", "출시"]\n701,["새로운 시장 기회 탐색\\n경쟁사 분석\\n고객 니즈 파악", "제품 컨셉 정의\\n기능 명세\\n시장성 평가", "상세 설계\\n프로토타입 개발\\n생산 계획", "품질 테스트\\n사용자 테스트\\n피드백 수집", "마케팅 캠페인\\n판매 채널 확보\\n고객 지원 준비"]`,
      'comparison-chart': `101,Comparison Chart\n102,Marketing\n201,Numerical\n202,Comparison\n301,Split Screen\n302,Brand Colors\n401,제품 기능 비교\n501,SVG\n601,["크기", "속도", "성능", "가격", "디자인"]\n603,["제품 A", "제품 B"]\n701,[8, 6, 9, 5, 8]\n702,[5, 9, 7, 7, 6]`,
      'timeline': `101,Timeline\n102,Educational\n201,Temporal\n202,Sequential\n301,Horizontal\n302,Cool Tones\n401,프로젝트 타임라인\n501,SVG\n601,["1월", "2월", "3월", "4월", "5월"]\n602,"진행도"\n701,["프로젝트 시작", "요구사항 분석", "디자인 완료", "개발 단계", "출시"]\n702,["초기 계획 및 팀 구성", "사용자 요구사항 수집 및 분석", "UI/UX 디자인 완료", "코어 기능 개발", "제품 출시 및 마케팅"]`
    };
    
    // 템플릿 선택 이벤트 직접 연결
    if (templateSelector && csvInput) {
      templateSelector.addEventListener('change', function() {
        const selectedTemplate = this.value;
        const templateContent = templateData[selectedTemplate];
        
        if (templateContent) {
          // CSV 입력 필드에 템플릿 데이터 적용
          csvInput.value = templateContent;
          
          // 차트 유형 추출 및 변경
          const chartTypeMatch = templateContent.match(/101,(.*)/);
          if (chartTypeMatch && chartTypeSelector) {
            chartTypeSelector.value = chartTypeMatch[1].trim();
          }
          
          // 성공 메시지 표시
          if (errorContainer) {
            errorContainer.innerHTML = '<div class="alert alert-success">템플릿이 적용되었습니다.</div>';
            setTimeout(() => { errorContainer.innerHTML = ''; }, 3000);
          }
        }
      });
    }
  });
</script>

<!-- 디버깅 스크립트 추가 -->
  <script>
  window.addEventListener('load', function() {
    console.log('페이지 로드 완료');
    
    // 모듈들의 글로벌 함수/변수 확인
    console.log('utils 모듈:', typeof getColorScheme);
    console.log('csv-parser 모듈:', typeof processCSV);
    console.log('chart-renderers 모듈:', typeof renderInfographic);
    console.log('main 모듈 window.generateInfographic:', typeof window.generateInfographic);
  });
  </script>
  
</body>
</html>
